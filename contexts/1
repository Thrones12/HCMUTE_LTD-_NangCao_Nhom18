from graphviz import Digraph

# Create ERD diagram
erd = Digraph(format="png")
erd.attr(rankdir="LR", size="8,5")
erd.attr('node', shape='record')

# Define entities and their attributes
entities = {
    "User": "{User|userId: UUID\\lemail: string\\lpassword: string\\lrole: enum\\lisVerified: boolean\\lname: string\\lphone: string\\lavatarUrl: string\\l}",
    "Program": "{Program|programId: UUID\\ltitle: string\\ldescription: string\\l}",
    "Subject": "{Subject|subjectId: UUID\\ltitle: string\\ldescription: string\\lprogramId: UUID\\l}",
    "Lesson": "{Lesson|lessonId: UUID\\ltitle: string\\ldescription: string\\lsubjectId: UUID\\l}",
    "Lecture": "{Lecture|lectureId: UUID\\lvideoUrl: string\\ldocumentUrl: string\\llessonId: UUID\\l}",
    "Exercise": "{Exercise|exerciseId: UUID\\ldescription: string\\llessonId: UUID\\l}",
    "Comment": "{Comment|commentId: UUID\\lcontent: string\\lcreatedAt: datetime\\llikes: int\\luserId: UUID\\llessonId: UUID\\lreplyTo: UUID (nullable)\\l}",
    "Exam": "{Exam|examId: UUID\\ltitle: string\\ldescription: string\\lsubjectId: UUID\\ldifficulty: string\\l}",
    "ExamResult": "{ExamResult|resultId: UUID\\lexamId: UUID\\luserId: UUID\\lscore: float\\lcompletedAt: datetime\\l}",
    "Challenge": "{Challenge|challengeId: UUID\\ltitle: string\\lquestions: list\\lduration: int\\l}",
    "ChallengeResult": "{ChallengeResult|resultId: UUID\\lchallengeId: UUID\\luserId: UUID\\lscore: float\\lcompletedAt: datetime\\l}",
    "SavedExam": "{SavedExam|savedId: UUID\\luserId: UUID\\lexamId: UUID\\l}",
    "ActivityLog": "{ActivityLog|logId: UUID\\luserId: UUID\\laction: string\\ltargetId: UUID\\ltimestamp: datetime\\l}",
    "Notification": "{Notification|notificationId: UUID\\luserId: UUID\\ltitle: string\\lcontent: string\\lisRead: boolean\\ltimestamp: datetime\\l}"
}

# Add entities
for entity, label in entities.items():
    erd.node(entity, label=label)

# Define relationships (only key ones for now)
relationships = [
    ("User", "Comment"),
    ("User", "ExamResult"),
    ("User", "ChallengeResult"),
    ("User", "SavedExam"),
    ("User", "ActivityLog"),
    ("User", "Notification"),
    ("Program", "Subject"),
    ("Subject", "Lesson"),
    ("Lesson", "Lecture"),
    ("Lesson", "Exercise"),
    ("Lesson", "Comment"),
    ("Subject", "Exam"),
    ("Exam", "ExamResult"),
    ("Challenge", "ChallengeResult"),
    ("Exam", "SavedExam"),
]

# Add relationships as edges
for from_entity, to_entity in relationships:
    erd.edge(from_entity, to_entity)

erd.render("/mnt/data/erd_diagram", view=False)
"/mnt/data/erd_diagram.png"
